{% extends "index.html" %}
{% block body %}
<body>
    <div id="app">
      <div v-cloak>
        <div class="v-cloak--inline">
          <div class="spinner"></div>
        </div>
        {# include 'includes/navheader.html' #}
        <div class="container v-cloak--hidden">
          <section>
            {% if config['DEBUG'] %}
            <p class="text-center mt-3">Warning: Running in debug mode. Set DEBUG = False in config file for Production deployment.</p>
            {% endif %}
            <div class="jumbotron jumbotron-border-gray mt-4 text-center">
              <div class="pricing-header px-3 py-3 mx-auto">
                <h1 class="display-4"><strong>BIMI</strong> LookUp & Generator</h1>
                <h4>Check your brand's compliance with BIMI standards</h4> 
              </div>
              <div class="row justify-content-md-center">
                <div class="card-deck col-md-8">
                  <div class="card md-12 shadow-sm">
                    <!-- <div class="card-header">
                      <h4 class="my-0 font-weight-normal">BIMI Checker</h4>
                    </div> -->
                    <div class="input-group lg-8 md-8">
                      <input type="text" v-on:keyup.enter="checkBimi" class="form-control p-2" placeholder="Domain Name (example.com)" aria-label="Domain Name" aria-describedby="basic-addon2" v-model="domain">
                      <div class="input-group-append">
                        <button class="btn btn-purple" @click="checkBimi" type="button">
                          <div v-if="bimi_check_button_loader" class="spinner-grow" role="status">
                            <span class="sr-only">Loading...</span>
                          </div>
                          Check BIMI</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <p class="text-danger pt-1" v-if="bimi_check_error">[[domain_validation_error]]</p>
              <!-- <div class="text-center">
                <p>(Note : Generation and validation BIMI record might take few seconds)</p>
              </div> -->
              <div class="row justify-content-md-center generate-heading-wrapper">
                <div class="col-md-8">
                  <div class="pricing-header">
                    <h4>Don't have a BIMI record?</h4>
                    <button class="btn btn-purple" @click="modifyBimi_scroll()">Generate BIMI</button>
                  </div>
                  <!-- <p class="release">This tool is currently in BETA and you might experience some delays in processing results. Feel free to share your feedback on dx@pepipost.com.</p> -->
                </div>
              </div>
            </div>
          </section>
          <section class="section shadow-sm" id="search_section" v-if="modifyBimi">
            <div class="modify-section" id="modify-section">
              <h2 class="tcolor">BIMI Generator</h2>
              <hr>
              <h5>Generate a new BIMI record</h5>
              <div class="generator-form mt-4">
                <form @submit.prevent="generateRecord()">
                  <div class="form-group">
                    <label for="domain">Enter Domain*</label>
                    <!-- was col-md-9 insted of 10 -->
                    <input required type="text" class="form-control col-md-9 p-2" id="domain" aria-describedby="domain" placeholder="Enter A Valid Domain Name" v-model="generate_bimi.domain">
                  </div>
                  <div class="form-group">
                    <label for="svg">SVG Image*</label>
                    <div class="row ml-1">
                      <input type="text" class="form-control col-md-9 p-2" @change="toggleEnableInput($event)" id="svg" placeholder="https://link-to-SVG-image" v-model="generate_bimi.svg_link"> 
                      <div class="col-md-3">
                        <span> -OR- </span>
                        <span>
                          <label class="btn btn-purple">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-folder2-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
                            </svg>
                            Browse <input type="file" ref="svgFile" @change="setSvg($event)" accept=".svg" hidden></label><span v-if="generate_bimi.svg_file">[[generate_bimi.svg_file.value]]</span>
                        </span><span class="browse_file_name" v-if="svg_selected_filename">[[svg_selected_filename]]</span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="vmc_cert">VMC Certificate file</label>
                    <div class="row ml-1">
                      <input type="text" class="form-control col-md-9 p-2" @change="toggleEnableInput($event)" id="vmc_cert" placeholder="https://link-to-vmc-cert-file"  v-model="generate_bimi.vmc_link"> 
                      <div class="col-md-3">
                        <span> -OR- </span>
                        <span>
                          <label class="btn btn-purple">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-folder2-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
                            </svg>
                            Browse <input type="file" ref="vmcFile" @change="setVmc($event)" accept=".pem" hidden></label>
                        </span><span class="browse_file_name" v-if="vmc_selected_filename">[[vmc_selected_filename]]</span>
                      </div>
                    </div>
                    <p>(Note : Loading and validating BIMI record might take few seconds)</p>
                  </div>
                  <!-- <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="exampleCheck1">
                    <label class="form-check-label" for="exampleCheck1">Check me out</label>
                  </div> -->
                  <button type="submit" class="btn btn-purple btn">
                    <div v-if="generate_bimi_loader" class="spinner-grow" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                      Generate BIMI Record</button>
                </form>
                <div class="generated" v-if="generated">
                  <h5>[[generated_bimi_response.message]]
                    <span class="checked" v-if="generated_bimi_response.status">
                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                      </svg>
                    </span>
                    <span v-else class="warned" v-else>
                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                      </svg>
                    </span>
                  </h5>
                  <div class="copy-button-wrapper">
                    <button class="btn-sm copy-btn" v-if="generated_bimi_response.record" @click="copyToClipboard($event)">copy</button>
                  </div>
                  <div class="code" v-if="generated_bimi_response.record">
                    <code>
                      [[generated_bimi_response.record]]
                    </code>
                  </div>
                  <!-- <div class="text-danger"  v-for="(generate_error, generate_error_index) in generated_bimi_response.errors" v-bind:key="generate_error_index">
                    <p>[[generate_error]]</p>
                  </div> -->
                  <div>
                    <b-alert show dismissible class="mt-4" v-if="generated_bimi_response.status == false" variant='warning' v-for="(generate_error, generate_error_index) in generated_bimi_response.errors" v-bind:key="generate_error_index">
                      <p><b>Warning: </b>[[generate_error]]</p>
                    </b-alert>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <section class="section shadow-sm" v-if="bimi_check_details">
            <div class="seach-result">
              <div class="record-found">
                <h2 class="tcolor">BIMI Audit Report For <strong>[[processed_domain]]</strong></h2>
                <hr>
                <div class="row">
                  <div class="col-md-8">
                    <div class="bimi-record" v-for="(result, index) in bimi_check_details" v-bind:key="index"  v-if="index !='svg_validation' && index !='vmc_validation'">
                      <div v-if="index !='svg_validation' && index !='vmc_validation'">
                        <h5><span class="record_name">[[index]]</span> Record 
                          <span v-if="result.status" class="checked">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                            </svg>
                          </span>
                          <span v-else class="warned">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                            </svg>
                          </span>
                        </h5>
                        <div class="alert alert-secondary mt-4 mr-5" role="alert" v-if="result.records && result.records.length > 0 && result.records[0] != ''">
                          <pre><div v-for="(mx, mx_index) in result.records" v-bind:key="mx_index"><code>[[mx]]</code></div></pre>
                        </div>
                        <div class="alert alert-secondary mt-4 mr-5" role="alert" v-if="result.record"><pre><code>[[result.record]]</code></pre>
                        </div>
                        <h6 class="status">
                            <div v-if="result.precheck">
                              <table class="table table-bordered table-sm">
                                <tbody>
                                  <tr>
                                    <th>Domain</th>
                                    <th>Status</th>
                                  </tr>
                                  <tr>
                                    <td>[[result.precheck.domain]]</td>
                                    <td>
                                      <span v-if="result.precheck.status">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                        </svg> Passed
                                      </span>
                                      <span v-else>
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                          <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                                        </svg> Failed
                                      </span> <br>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td>[[result.domain]]</td>
                                    <td>
                                      <span v-if="result.status">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                          <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                        </svg> Passed
                                      </span>
                                      <span v-else>
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                          <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                                        </svg> Failed
                                      </span>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            <p>
                              <span v-if="result.records && result.records.length > 0 && result.records[0] != ''">
                                <span class="record_name">[[index]]</span>
                                 record found for [[result.domain]], 
                              </span>
                              <span v-else-if="result.record">
                                <span class="record_name">[[index]]</span>
                                  record found for [[result.domain]], 
                              </span>
                              <span v-else>
                                <span class="record_name">[[index]]</span>
                                record not found for [[result.domain]].
                              </span>
                              <span v-if="result.status">and is BIMI compliant
                                <span v-if="result.warnings.length > 0 && result.warnings[0]!=''">, but with few warnings.
                                </span> <span v-if="result.note && result.status"> While it may work for BIMI, please see the warnings below for more information.</span>
                              </span>
                              <span v-else> <span v-if='result.record'>However, it is not as per the required BIMI specifications. Please check the warnings below for suggestions.</span>
                              </span>
                            </p>
                        </h6>

                        <div class="issues" v-if="result.warnings.length > 0 || result.errors.length > 0">
                          <h6><strong>Warnings in <span class="record_name">[[index]]</span> record for [[result.domain]]</strong></h6>
                          <ul class="warnings" v-if="result.warnings.length > 0">
                            <li v-for="(warning, warn_index) in result.warnings" v-bind:key="warn_index" v-if="warning">Warning: [[warning]]</li>
                          </ul>
                          <ul class="warnings" v-if="result.errors.length > 0">
                            <li v-for="(error, error_index) in result.errors" v-bind:key="error_index" v-if="error">Warning: [[error]]</li>
                          </ul>
                        </div>

                        <div class="issues" v-if="result.precheck && ('warnings' in result.precheck || 'errors' in result.precheck)">
                          <h6><strong>Warnings in <span class="record_name">[[index]]</span> record for [[result.precheck.domain]]</strong></h6>
                          <ul class="warnings">
                            <li v-for="(pwarning, p_warn_index) in result.precheck.warnings" v-bind:key="p_warn_index" v-if="pwarning">Warning: [[pwarning]]</li>
                          </ul>
                          <ul class="warnings">
                            <li v-for="(perror, p_error_index) in result.precheck.errors" v-bind:key="p_error_index" v-if="perror">Warning: [[perror]]</li>
                          </ul>
                        </div>

                        <div class="alert alert-dark d-flex align-items-center" role="alert" v-if="result.note">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2 mr-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                              <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                            </svg>
                            <div> [[result.note]]</div>
                        </div>

                      </div>
                    </div>
                    <div class="svg-image">
                      <h5>
                        BIMI SVG Image 
                        <span class="warned" v-if="!bimi_check_details.svg_validation.status">
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                          </svg>
                        </span>
                        <span class="checked" v-else>
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                          </svg>
                        </span>
                      </h5>
                      <h6 class="status">
                        <span v-if="bimi_check_details.svg_validation.svg_link">We found the following SVG image in your BIMI record. 
                          <span v-if="bimi_check_details.svg_validation.status">Your SVG image is as per BIMI compliance. </span>               
                            <span v-else> The SVG Image needs an Update, check the errors below for more details.</span></span>
                        <span v-else> We didn't find any valid SVG link in the BIMI record.</span>
                        <!-- <span v-if="!bimi_check_details.svg_validation.status">
                          Found few problems
                        </span>
                         <span v-else-if="bimi_check_details.svg_validation.svg_link">
                          Found BIMI SVG Image
                        </span>
                        <span v-else>
                          Found
                        </span> -->
                      </h6>
                      <div class="alert alert-secondary mt-4 mr-5" role="alert" v-if="bimi_check_details.svg_validation.svg_link">
                        <em><a class="format-anchor" target="_blank" :href="bimi_check_details.svg_validation.svg_link">[[svg_display_link]]</a></em>
                        <p v-if="generated_note_svg">
                          <strong>Note:-</strong> [[generated_note_svg]]
                        </p>
                      </div>
                      <div class="row">
                        <div class="col-md-10 mb-3">
                          <b-form-checkbox v-model="background_toggle" name="check-button" switch size="lg">
                            Switch Logo-box Background
                          </b-form-checkbox>
                        </div>
                      </div>
                      <div class="row">
                        <div class="logo-box ml-md-4 col-md-3 square">
                          <div v-bind:class="['square', {'dark-background':background_toggle}]" :style="{'background-image':'url('+img_logo+')'}">
                            <!-- <img class="img-fluid" :src="img_logo"> -->
                          </div>
                        </div>
                        <div class="logo-box ml-md-4 mr-md-4 col-md-3 square">
                          <div v-bind:class="['circle', {'dark-background':background_toggle}]" :style="{'background-image':'url('+img_logo+')'}">
                            <!-- <img class="img-fluid" :src="img_logo"> -->
                          </div>
                        </div>
                        <div class="logo-box squircle col-md-3 square">
                          <div v-bind:class="['squircle', {'dark-background':background_toggle}]" :style="{'background-image':'url('+img_logo+')'}">
                            <!-- <img class="img-fluid" :src="img_logo"> -->
                          </div>
                        </div>
                      </div>
                      <div class="issues-button-wrapper text-center">
                        <button @click="toggle_svg_errors()" v-if="bimi_check_details.svg_validation.errors.length > 3" class="btn btn-outline-danger btn-red btn-sm">View Issues</button>
                      </div>
                      <div class="issues" v-if="bimi_check_details.svg_validation.errors.length <= 3 && bimi_check_details.svg_validation.errors.length > 0">
                        <h5>SVG Issues You Need To Fix</h5>
                        <ul v-for="(bimi_error, bimi_error_index) in bimi_check_details.svg_validation.errors">
                          <li>
                            <span class="short_error">[[bimi_error.short_error]]</span>
                            <div class="expand_error_button">More Details <span class="text-danger" v-b-toggle.collapse-bimi_error_index @click="expand_error($event)">[+]</span></div>
                            <p :class="'error_details '+active_class_name" :id="'collapse-'+bimi_error_index">[[bimi_error.error_details]]</p>
                          </li>
                        </ul>
                      </div>
                      <div class="issues" v-if="bimi_check_details.svg_validation.errors.length > 3 && svg_errors_toggle">
                        <h5>SVG Issues You Need To Fix</h5>
                        <ul v-for="(bimi_error, bimi_error_index) in bimi_check_details.svg_validation.errors">
                          <li>
                            <span class="short_error">[[bimi_error.short_error]]</span>
                            <div class="expand_error_button">More Details <span class="text-danger" v-b-toggle.collapse-bimi_error_index @click="expand_error($event)">[+]</span></div>
                            <p :class="'error_details '+active_class_name" :id="'collapse-'+bimi_error_index">[[bimi_error.error_details]]</p>
                          </li>
                        </ul>
                        <!-- <div class="fix-svg" v-if="bimi_check_details.svg_validation.errors.length > 0 && img_logo != 'static/assets/images/error.svg'">
                          <button class="btn btn-md btn-outline-warning" @click="fixSvg">
                            <div v-if="fix_svg_loader" class="spinner-grow" role="status">
                              <span class="sr-only">Loading...</span>
                            </div>
                            Fix SVG Issues</button>
                            <p v-if="fix_svg_details.fixed_svg_link">
                              Click <a :href="fix_svg_details.fixed_svg_link">
                                here
                              </a> to view the fixed file.
                            </p>
                        </div> -->
                      </div>
                    </div>
                    <div class="vmc-certificate" v-if="bimi_check_details.vmc_validation.status!='Option'">
                      <h5>
                        VMC Certificate 
                        <span class="checked" v-if="bimi_check_details.vmc_validation.status">
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                          </svg>
                        </span>
                        <span v-else class="warned">
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                          </svg>
                        </span>
                      </h5>
                      <h6 class="stautus">
                        <span v-if="bimi_check_details.vmc_validation.vmc_link">We found the following vmc certificate in your BIMI record. 
                          <span v-if="bimi_check_details.vmc_validation.status">Your vmc certificate is as per the BIMI compliance. </span>               
                            <span v-else> The vmc certificate needs an Update, check the errors below for more details.</span></span>
                        <span v-else> We didn't find any valid .pem file link in the BIMI record.</span>

                        <!-- <span v-if="!bimi_check_details.vmc_validation.status">
                          Found few problems
                        </span>
                        <span v-else-if="bimi_check_details.vmc_validation.vmc_link!=''">
                          Found VMC certificate File
                        </span>
                        <span v-else>
                          VMC certificate File not found
                        </span> -->
                      </h6>
                      <div class="alert alert-secondary mt-4 mr-5" role="alert" v-if="bimi_check_details.vmc_validation.vmc_link">
                        <em><a class="format-anchor" target="_blank" :href="bimi_check_details.vmc_validation.vmc_link">[[vmc_display_link]]</a></em>
                        <p v-if="generated_note_vmc">
                          <strong>Note:-</strong> [[generated_note_vmc]]
                        </p>
                      </div>
                      <div class="issues" v-if="bimi_check_details.vmc_validation.errors.length > 0">
                        <h5>VMC Certificate File Issues You Need To Fix</h5>
                        <ul>
                          <li v-for="(vmc_error, vmc_error_index) in bimi_check_details.vmc_validation.errors">
                            [[vmc_error]]
                            <!-- <span class="short_error">[[bimi_error.short_error]]</span>
                            <div class="expand_error_button">More Detials <span class="text-danger" v-b-toggle.collapse-bimi_error_index @click="expand_error($event)">[+]</span></div>
                            <p :class="'error_details '+active_class_name" :id="'collapse-'+bimi_error_index">[[bimi_error.error_details]]</p> -->
                          </li>
                        </ul>
                        <!-- <button class="btn btn-sm btn-outline-purple">Fix SVG Issues</button> -->
                      </div>
                    </div>
                    <div v-else>
                      <div class="alert alert-dark d-flex align-items-center" role="alert">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2 mr-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                          <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                        </svg>
                          <div>Note: While your BIMI record is compliant, it doesn't include a Verified Mark Certificate that may be required by some mailbox providers.</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <h5>Your Logo Might Appear Like This</h5>
                    <!-- Mobile box -->
                    <div class=" col-md-12">
                      <div class="iphone-x">
                        <div class="content">
                          <i>Speaker</i>
                          <b>Camera</b>
                          <!-- <img src="./static/assets/images/mobile-top.jpg" class="img-fluid mobi-strip"> -->
                          <div class="esp-brand-strip row">
                            <div class="time col-3">
                              <p> 7:15</p>
                            </div>
                            <div class="Label col-5">
                              
                            </div>
                            <div class="search col-4">
                              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-wifi-2" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13.229 8.271c.216-.216.194-.578-.063-.745A9.456 9.456 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.577 1.336c.205.132.48.108.652-.065zm-2.183 2.183c.226-.226.185-.605-.1-.75A6.473 6.473 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.408.19.611.09A5.478 5.478 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.611-.091l.015-.015zM9.06 12.44c.196-.196.198-.52-.04-.66A1.99 1.99 0 0 0 8 11.5a1.99 1.99 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .708 0l.707-.707z"/>
                              </svg>
                              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-reception-4" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0 11.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-5zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-8zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-11z"/>
                              </svg>
                            </div>
                          </div>
                          <div class="esp-brand-strip row">
                            <div class="burger col-3">
                              <div></div>
                              <div></div>
                              <div></div>
                            </div>
                            <div class="Label col-6">
                              Inbox
                            </div>
                            <div class="search col-3">
                              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
                                <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                              </svg>
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div v-bind:class="['logo_image_wrapper_circle', {'dark-background':background_toggle}]">
                                  <img :src="img_logo" alt="" class="logo_image img-fluid">
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section">
                                  <div class="brandname">[[processed_domain]]</div>
                                  <div class="brand_subject">Your Email Subject Line...</div>
                                  <div class="brand_message">Your email text messag... 
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div v-bind:class="['logo_image_wrapper_squircle', {'dark-background':background_toggle}]">
                                  <img :src="img_logo" alt="" class="logo_image img-fluid">
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section">
                                  <div class="brandname">[[processed_domain]]</div>
                                  <div class="brand_subject">Your Email Subject Line...</div>
                                  <div class="brand_message">Your email text messag... 
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div class="logo_image_wrapper_circle bg-secondary">
                                  <span class="chars">
                                    A	
                                  </span>
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section-bar">
                                  <div class="brandname"><hr></div>
                                  <div class="brand_subject"><hr></div>
                                  <div class="brand_message"><hr>
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div class="logo_image_wrapper_circle bg-warning">
                                  <span class="chars">
                                    B	
                                  </span>
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section-bar">
                                  <div class="brandname"><hr></div>
                                  <div class="brand_subject"><hr></div>
                                  <div class="brand_message"><hr> 
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div class="logo_image_wrapper_circle bg-danger">
                                  <span class="chars">
                                    C	
                                  </span>
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section-bar">
                                  <div class="brandname"><hr></div>
                                  <div class="brand_subject"><hr></div>
                                  <div class="brand_message"><hr>
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div class="logo_image_wrapper_circle bg-success">
                                  <span class="chars">
                                    D	
                                  </span>
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section-bar">
                                  <div class="brandname"><hr></div>
                                  <div class="brand_subject"><hr></div>
                                  <div class="brand_message"><hr>
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                          <div class="grid shadow-sm">
                            <div class="row">
                              <div class="col-3">
                                <div class="logo_image_wrapper_circle bg-primary">
                                  <span class="chars">
                                    E	
                                  </span>
                                </div>
                              </div>
                              <div class="col-9">
                                <div class="text-section-bar">
                                  <div class="brandname"><hr></div>
                                  <div class="brand_subject"><hr></div>
                                  <div class="brand_message"><hr>
                                    <span class="star">
                                      <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                      </svg>
                                    </span>
                                  </div>
                                </div>
                              </div>	
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>	 
                </div>
                <div class="text-center">
                  <button class="btn btn-outline-purple" @click="modifyBimi_scroll()">[[bimi_generate_text]]</button>
                </div>
              </div>
            </div>
          </section>
          <section class="section shadow-sm">
            <h2 class="tcolor">About BIMI</h2>
            <hr>
            <p>Brand Indicators for Message Identification abbreviated as BIMI is an email specification which gives a brand the flexibility to decide on what logo should appear as sender in all outgoing email messages. </p>
            <p>There is no platform to define BIMI. It's just a set of DNS based instructions which you will be passing to an email client requesting them to show your logo in the email messages. BIMI doesn't guarantee the display of your logo as it works only with the supported email clients. </p>
          </section>
          {% include 'includes/footer.html' %}
        </div>
      </div>
    </div>
  <script type="text/babel">
      new Vue({
          el: '#app',
          delimiters: ["[[","]]"],
          presets: [
            ['@vue/app', {
              polyfills: ['es.array.iterator', 'es.promise', 'es.object.assign', 'es.promise.finally']
            }]
          ],
          data() {
            return {
              loading: true,
              bimi_check_details: null,
              bimi_check_button_loader: false,
              apiurls: {
                checkBimiRecord: window.location + "/check-bimi",
                generateBimiRecord: window.location + "/generate-bimi",
                fixBimiRecord: window.location + "/fix-bimi"
              },
              processed_domain: "",
              searchStatus: false,
              domain: null,
              img_logo: "",
              modifyBimi: false,
              bimi_check_error: false,
              generated: false,
              domain_validation_error: "",
              bimi_generate_text: "Generate BIMI Record?",
              svg_display_link: "",
              vmc_display_link: "",
              generate_bimi : {
                domain: "",
                svg_link: "",
                vmc_link: "",
                svg_file: {},
                vmc_file: {}
              },
              active_class_name: "inactive_element",
              generated_bimi_response: {},
              generate_bimi_loader: false,
              svg_not_found: "static/assets/images/error.svg",
              generated_note_svg: null,
              generated_note_vmc: null,
              vmc_selected_filename: null,
              svg_selected_filename: null,
              svg_errors_toggle: false,
              fix_svg_loader: false,
              fix_svg_details: [],
              background_toggle: false
            }
          },
          methods: {
            checkBimi() {
              if (!this.bimi_check_button_loader) {
                this.generated = false;
                this.domain = this.domain ? this.domain.toLowerCase() : undefined;
                if (this.validate_domain(this.domain)) {
                  this.bimi_check_button_loader = true;
                  this.modifyBimi = false;
                  this.generated_note_svg = null;
                  axios.post(this.apiurls.checkBimiRecord, {
                    domain: this.domain        
                  })
                  .then((response) => {
                    console.log(response.data);
                    this.bimi_check_details = response.data;
                    this.bimi_check_button_loader = false;
                    this.processed_domain = this.domain;
                    this.img_logo = response.data.svg_validation.svg_link ? response.data.svg_validation.svg_link : this.svg_not_found;
                    this.generate_bimi.domain = this.domain;
                    this.svg_display_link = response.data.svg_validation.svg_link;
                    this.vmc_display_link = response.data.vmc_validation.vmc_link;
                    if (!this.bimi_check_details.bimi.status) {
                      this.bimi_generate_text = "Generate BIMI Record?";
                    } else {
                      this.bimi_generate_text = "Modify BIMI Record?";
                    }
                  })
                  .catch((error) => {
                    console.log(error);
                    this.bimi_check_button_loader = false;
                  });
                } else {
                  this.bimi_check_error = true;
                }
              }
            },
            setSvg(e) {
              this.generate_bimi.svg_file = this.$refs.svgFile.files;
              this.toggleEnableInput(e);
              this.set_file_name(this.$refs.svgFile.files, "svg");
            },
            setVmc(e) {
              this.generate_bimi.vmc_file = this.$refs.vmcFile.files;
              this.toggleEnableInput(e);
              this.set_file_name(this.$refs.vmcFile.files, "vmc");
            },
            set_file_name(file, set_to){
              if (set_to === "svg") {
                this.svg_selected_filename = file[0].name;
                console.log(file[0].name);
              } else {
                this.vmc_selected_filename = file[0].name;
                console.log(file[0].name);
              }
            },
            toggleEnableInput(e) {
              let element = e.target;
              if (element.getAttribute('type') === 'text') {
                if (element.value) {
                  element.parentElement.querySelector('input[type="file"]').setAttribute("disabled", "true");
                  element.parentElement.querySelector('.col-md-3 span .btn.btn-purple').classList.add("disabled");
                } else {
                  element.parentElement.querySelector('input[type="file"]').removeAttribute("disabled");
                  element.parentElement.querySelector('.col-md-3 span .btn.btn-purple').classList.remove("disabled");
                }
              } else if (element.getAttribute('type') === 'file') {
                if(element.value && element.files.length !== 0){
                  element.parentElement.parentElement.parentElement.parentElement.querySelector('input[type="text"]').setAttribute("disabled", "true");
                  element.parentElement.parentElement.parentElement.parentElement.querySelector('input[type="text"]').classList.add("disabled");
                } else {
                  element.parentElement.parentElement.parentElement.parentElement.querySelector('input[type="text"]').removeAttribute("disabled");
                  element.parentElement.parentElement.parentElement.parentElement.querySelector('input[type="text"]').classList.remove("disabled");
                }
              }
            },
            validate_domain(domain){
              // const REGEX_DOMAIN = /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+$/gm
              const REGEX_DOMAIN = /^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]$/gm;
              if (!domain) {
                this.domain_validation_error = "Please enter a domain";
                return false;
              } else if (REGEX_DOMAIN.exec(domain.trim())) {
                this.domain_validation_error = "";
                return true;
              } else {
                this.domain_validation_error = "Invalid domain name";
                return false;
              }
            },
            toggle_sign(element) {
              let span_text = element;
              // console.log(span_text);
              if(span_text.innerHTML === "[+]") {
                span_text.innerHTML = "[-]";
              } else {
                span_text.innerHTML = "[+]";
              }
            },
            expand_error(e) {
              let span_element = e.target;
              this.toggle_sign(span_element);
              if (span_element.parentElement.nextElementSibling.classList.contains(this.active_class_name)) {
                span_element.parentElement.nextElementSibling.classList.remove(this.active_class_name);
              } else {
                span_element.parentElement.nextElementSibling.classList.add(this.active_class_name);
              }
            },
            modifyBimi_scroll() {
              // this.modifyBimi = !this.modifyBimi;
              this.modifyBimi = true;
              this.$nextTick(function () {
                let top_element = document.getElementById("search_section");
                top_element.scrollIntoView({block: "start", behavior: "smooth"});
              });
              // top_element.scrollTo(0, 0);
            },
            generateNoteSvg(checkstring) {
              if (checkstring.includes('public-path-to-')) {
                this.generated_note_svg = "This is an example url for your uploaded SVG Image url, as of what it might look like.\n You can use the uploaded file to setup a link to the file and set-up your BIMI record.\n Check the example in the generated BIMI record. \n Click on the image path to check the SVG Image.";
              } else {
                this.generated_note_svg = "";
              }
              return checkstring;
            },
            generateNoteVmc(checkstring) {
              if (checkstring.includes('public-path-to-')) {
                this.generated_note_vmc = "This is an example url for your uploaded Vmc certificate file, as of what it might look like.\n You can use the uploaded file to setup a link to the file and set-up your BIMI record.\n Check the example in the generated BIMI record. \n Click on the certificate path to check the Certificate file.";
              } else {
                this.generated_note_vmc = "";
              }
              return checkstring;
            },
            toggle_svg_errors() {
              this.svg_errors_toggle = !this.svg_errors_toggle;
            },
            copyToClipboard(element) {
              let elementStr = element.target.parentElement.nextElementSibling.firstChild.innerHTML;
              console.log(elementStr);
              if (navigator && navigator.clipboard) {
                try {
                   navigator.clipboard.writeText(elementStr);
                   return;
                }
                catch (e) {
                  console.warn("Copy to clipboard using navigator failed", e);
                 }
              }
              console.info("Navigator API seems not supported, using deprecated fallback");

              const el = document.createElement('textarea');
              el.setAttribute('readonly', '');
              el.style.position = 'absolute';
              el.style.left = '-9999px';
              document.body.appendChild(el);
              el.value = elementStr;
              el.select();
              document.execCommand('copy');
              setTimeout(() => document.body.removeChild(el), 1000);
            },
            generateRecord() {
              this.generate_bimi_loader = true;
              const svg_regex = /((https:)[\\|\/\/].*?\.svg$)/gm;
              const vmc_regex = /((https:)[\\|\/\/].*?\.pem$)/gm;
              let error = 0;
              let error_message = null;
              this.generated_note_svg = null;
              this.generate_bimi.domain = this.generate_bimi.domain ? this.generate_bimi.domain.toLowerCase() : undefined;
              if (!this.validate_domain(this.generate_bimi.domain)) {
                error = 1;
                error_message = "Invalid domain";
              }

              if (this.generate_bimi.svg_link) {
                if (!svg_regex.exec(this.generate_bimi.svg_link)) {
                  error = 1;
                  error_message = "Invalid svg link provided. Please enter url in format https://domain.com/path/file.svg";
                }
              } else {
                if (Object.keys(this.generate_bimi.svg_file).length === 0 && this.generate_bimi.svg_file.constructor === Object) {
                  error = 1;
                  error_message = "Please enter an valid svg link or Upload SVG file";
                }
                if (Object.keys(this.generate_bimi.svg_file).length !== 0 && !this.generate_bimi.svg_file[0].name.endsWith(".svg")) {
                  error = 1;
                  error_message = "Please select an svg file";
                }
              }

              if (this.generate_bimi.vmc_link) {
                if (!vmc_regex.exec(this.generate_bimi.vmc_link)) {
                  error = 1;
                  error_message = "Invalid pem link provided. Please enter url in format https://domain.com/path/file.pem";
                }
              } else {
                if (Object.keys(this.generate_bimi.vmc_file).length !== 0 && !this.generate_bimi.vmc_file[0].name.endsWith(".pem")) {
                  error = 1;
                  error_message = "Please enter an valid vmc link or Upload a .pem file";
                }
              }

              if (error === 1) {
                alert(error_message);
                this.generate_bimi_loader = false;
              }
              else {
                const formData = new FormData();
                formData.append("domain", this.generate_bimi.domain);
                formData.append("svg_link", this.generate_bimi.svg_link);
                formData.append("vmc_link", this.generate_bimi.vmc_link);
                formData.append("svg_file", this.generate_bimi.svg_file[0]);
                formData.append("vmc_file", this.generate_bimi.vmc_file[0]);
                axios.post(this.apiurls.generateBimiRecord, formData, {
                            headers: {
                              'Content-Type': 'multipart/form-data'
                            }
                          })
                  .then((response) => {
                    // console.log(response);
                    this.generated_bimi_response = response.data.bimi_generation;
                    this.bimi_check_details = {bimi: response.data.bimi, dmarc: response.data.dmarc, mx: response.data.mx, spf: response.data.spf, svg_validation: response.data.svg_validation, vmc_validation: response.data.vmc_validation};
                    this.img_logo = response.data.svg_validation.svg_link ? response.data.svg_validation.svg_link : this.svg_not_found;
                    this.generated = true;
                    this.generate_bimi_loader = false;
                    this.processed_domain = this.generate_bimi.domain;
                    this.svg_display_link = response.data.bimi_generation.svg_link ? response.data.bimi_generation.svg_link : "";
                    this.vmc_display_link = response.data.bimi_generation.vmc_link ? response.data.bimi_generation.vmc_link : "";
                    this.generateNoteSvg(this.svg_display_link);
                    this.generateNoteVmc(this.vmc_display_link);
                  })
                  .catch((error) => {
                    console.log(error);
                    this.generate_bimi_loader = false;
                  });
              } 
            },
            fixSvg() {
              this.fix_svg_loader = true;
              let file = false;
              if (this.generated) {
                file = true;
              }
              axios.post(this.apiurls.fixBimiRecord, {
                domain: this.processed_domain, svg_path: this.img_logo, file: file    
              })
              .then((response) => {
                console.log(response.data.status);
                if (response.data.status) {
                  this.fix_svg_details = response.data;
                  this.fix_svg_loader = false;
                } else {
                  this.fix_svg_details.push({error:"Error connecting to the endpoint"});
                  this.fix_svg_loader = false;
                }
              })
              .catch((error) => {
                console.log(error);
                this.fix_svg_loader = false;
              });
            }
          },
       })
  </script>
</body>
<!--
<style scoped>
	.release {
    color: #646464;
    padding: 0 1.5625rem;
    margin-top: 15px;
    font-size: 12px;
  }
</style>
-->
{% endblock %}
